# 메모리 기초
도서관에서 책을 찾는 방법과 프로그램이 동작하는 방법에는 지역성의 원칙이 똑같이 적용된다. 어떤 순간에 사용하는 책은 도서관의 모든 책 중에서 극히 일부이듯이, 프로그램은 어떤 특정 시간에는 주소 공간 내의 비교적 작은 부분만을 접근한다는 것이 지역성의 원칙이다. 지역성에는 다음과 같이 두 가지 종류가 있다.  
- 시간적 지역성: 한번 참조된 항목은 곧바로 다시 참조되는 경향이 있다.  
- 공간적 지역성: 어떤 항목이 참조되면 그 근처에 있는 다른 항목들이 곧바로 참조될 가능성이 높다.  
  
## 메모리 계층 구조 
컴퓨터의 메모리를 메모리 계층구조(memory hierarchy)로 구현함으로써 지역성의 원칙을 이용할 수 있다. 메모리 계층구조는 서로 다른 속도와 크기를 갖는 여러 계층의 메모리로 구성되어 있다. 가장 빠른 메모리는 더 느린 메모리보다 비트당 가격이 비싸기 때문에 대개 그 크기가 작다. 프로세서로부터 거리가 멀어질수록 메모리의 크기와 접근시간은 증가하고 비트당 가격은 내려간다.  
  
![memory hierarchy](https://github.com/user-attachments/assets/8bed409d-8826-4437-b26f-9bd241e46c90)  
  
**메모리 계층구조의 목적은 사용자에게 가장 빠른 메모리의 접근 속도를 제공하면서 동시에 가장 싼 메모리만큼의 용량을 제공하는 것이다.**    
메모리 계층구조는 여러 계층으로 구성되지만, 데이터는 인접한 두 계층 사이에서만 한 번에 복사가 된다. 두 계층 간 정보 전송의 최소 단위를 블록(block) 또는 라인(line)이라고 부른다.  
> 각각의 계층 안에서 정보가 존재하든 또는 존재하지 않든 그 기본 단위는 블록 또는 라인이라고 불린다. 계층 간에 무엇인가를 복사할 때에는 대개 블록 전체가 이동된다.  
  
프로세서가 요구한 데이터가 상위 계층의 어떤 블록에 있을 때 이를 적중(hit)이라고 부른다. 그리고 상위 계층에서 찾을 수 없다면 이를 실패(miss)라고 부른다. 이때는 필요한 데이터를 포함하는 블록을 찾기 위해 하위 계층 메모리를 접근하게 된다.  
적중률(hit rate 또는 hit ratio)은 메모리 접근 중 상위 계층에서 찾을 수 있는 것의 비율로서 메모리 계층의 성능을 평가하는 척도로 이용된다. 실패율(miss rate, 1 - 적중률)은 메모리 접근 중 상위 계층에서 찾을 수 없는 것의 비율을 말한다.  
  
적중시간(hit time)은 메모리 계층구조의 상위 계층을 접근하는 데 걸리는 시간이며 이 시간에는 접근이 적중인지 실패인지를 결정하는 데 필요한 시간이 포함된다. 실패 손실(miss penalty)은 하위 계층에서 해당 블록을 가져와서 상위 계층 블록과 교체하는 시간에다 그 블록을 프로세서에 보내는 데 걸리는 시간을 더한 값이다.  
  
상위 계층은 작고 빠른 메모리를 사용하여 만들어졌기 때문에 적중시간은 다음 계층을 접근하는 시간보다 훨씬 적게 걸린다. 실패 손실의 대부분은 다음 계층 접근시간이다.  
  
> 메모리 계층구조는 최근에 접근했던 데이터들을 프로세서 가까이 적재함으로써 시간적 지역성을 이용한다. 또한 필요한 데이터뿐만 아니라 이와 인접한 다량의 데이터들로 이루어진 블록을 메모리의 상위 계층으로 옮김으로써 공간적 지역성을 이용한다. 대부분의 시스템에서 메모리는 정말로 계층적이다. 즉 계층 i + 1에 존재하지 않는 데이터는 게층 i에 존재할 수 없다.  