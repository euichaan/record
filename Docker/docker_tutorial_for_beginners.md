# A Docker Tutorial for Beginners
docker run -it busybox sh

docker 는 매번 새 컨테이너를 생성하므로 모든 것이 다시 작동한다.
방치된 컨테이너는 디스크 공간을 차지하게 된다. 따라서 일반적으로 컨테이너를 사용한 후에는 정리한다.

한 번에 삭제해야 할 컨테이너가 많은 경우
ID를 복사하여 붙여넣는 작업이 번거로울 수 있다.
docker rm $(docker ps -a -q -f status=exited)

-q flag는 숫자 ID만 반환하고 -f는 제공된 조건에 따라 출력을 필터링한다.

최신 버전의 Docker는, docker container prune 커맨드를 사용해 같은 효과를 볼 수 있다.
docker container prune
WARNING! This will remove all stopped containers.
Are you sure you want to continue? [y/N] y
Total reclaimed space: 0B

더 이상 필요하지 않은 이미지는 docker rmi를 실행하여 삭제할 수도 있다.

docker images로 Docker 이미지 목록을 확인할 수 있다.

사용되지 않는 이미지를 삭제하려면 docker image prune 커맨드를 사용한다.

이미지 - 컨테이너의 기초가 되는 애플리케이션의 청사진.
컨테이너 - Docker 이미지에서 생성하여 실제 애플리케이션을 실행한다.
도커 데몬 - 호스트에서 실행되는 백그라운드 서비스로, Docker 컨테이너 빌드, 실행 및 배포를 관리한다. 데몬은 클라이언트가 통신하는 운영 체제에서 실행되는 프로세스이다.
도커 클라이언트 - 사용자가 데몬과 상호작용할 수 있는 명령줄 도구
도커 허브 - Docker image registry. 레지스트리는 사용 가능한 모든 Docker 이미지의 디렉토리로 생각할 수 있다. 필요한 경우, 자체 Docker 레지스트리를 호스팅하여 이미지를 가져오는 데 사용할 수 있다.

docker run을 사용해서 한 번에 이미지를 직접 다운로드하고 실행할 수 있다.
--rm 플래그는 컨테이너가 종료될 때 자동으로 컨테이너를 제거하며, -it 플래그는 대화형 터미널을 지정하여 컨테이너를 쉽게 종료할 수 있도록 한다.

interactive 모드는 컨테이너와 사용자 간의 상호작용을 가능하게 한다. 즉, 사용자가 컨테이너 내에서 실행되는 프로그램과 직접 통신할 수 있는 모드이다. -i 플래그는 표준 입력(입력 스트림)을 열어 두고, -t 플래그는 가상 터미널(tty)을 할당하여 사용자와 컨테이너 간의 상호작용을 가능하게 한다.

docker를 이용해서 단순한 정적 웹사이트를 실행해 보자.

docker run --rm -it prakhar1989/static-site
이미지가 로컬에 존재하지 않으므로 클라이언트는 먼저 레지스트리에서 이미지를 가져온 다음 이미지를 실행한다. Nginx is running 메시지를 볼 수 있는데, 서버가 실행 중이니 웹사이트를 어떻게 볼 수 있을까?

이 경우 클라이언트가 포트를 노출하지 않으므로 포트를 공개하려면 docker run 명령을 다시 실행해야 한다.
터미널이 실행 중인 컨테이너에 부착되지 않도록 하는 방법도 찾아야 한다. 이렇게 하면 터미널을 닫고 컨테이너를 계속 실행할 수 있다. 이를 detaced mode라고 한다.

-d 옵션을 사용하면 컨테이너가 백그라운드에서 실행된다. 컨테이너가 실행되면 컨테이너 ID가 출력된다. 백그라운드 모드로 실행된 컨테이너는 터미널 세션과 분리되어 있어 터미널 세션이 종료되더라도 컨테이너는 계속 실행된다.

docker run -d -P --name static-site prakhar1989/static-site
-P 옵션으로 노출된 모든 포트를 임의의 포트에 공개한다.

이제 docker port static-site 로 포트를 볼 수 있다.

분리된 컨테이너를 중지하려면 컨테이너 ID를 지정해 docker stop 명령어를 사용한다.

docker run -d -p 8888:80 prakhar1989/static-site
prakhar1989/static-site 이미지를 기반으로 컨테이너를 생성하고 실행하는데, 호스트 머신의 포트 8888을 컨테이너의 포트 80에 매핑하는 역할을 한다. 이를 통해 호스트 머신의 포트 8888로 들어오는 요청이 컨테이너 내부의 포트 80 으로 전달된다.

Docker 이미지는 컨테이너의 기본이다. Docker 클라이언트에서 해당 이미지를 기반으로 컨테이너를 실행하도록 요청했다.

태그는 이미지의 특정 스냅샷을 가리키고 이미지 ID는 해당 이미지에 해당하는 고유 식별자이다.
특정 버전 번호를 제공하지 않으면 클라이언트는 기본적으로 최신 버전을 사용한다.

docker pull ubuntu:18.04

새 Docker 이미지를 얻으려면 레지스트리(ex: Docker Hub)에서 가져오거나 직접 만들 수 있다. CLI 에서 docker search를 사용해서 이미지를 직접 검색할 수도 있다.

이미지와 관련하여 알아야 할 중요한 차이점은 기본 이미지와 하위 이미지의 차이이다.

기본 이미지는 상위 이미지가 없는 이미지로, 일반적으로 우분투, busybox, debian과 같은 운영체제가 설치된 이미지이다. 하위 이미지는 기본 이미지를 기반으로 하여 추가 기능을 추가하는 이미지이다.

그런 다음 공식 이미지와 사용자 이미지가 있으며, 기본 이미지와 하위 이미지가 모두 될 수 있다.
공식 이미지는 Docker에서 공식적으로 유지 관리하고 지원하는 이미지이다.
사용자 이미지는 사용자가 만들고 공유하는 이미지이며, 기본 이미지를 기반으로 하여 추가 기능을 추가한다. 일반적으로 user/image-name 으로 형식이 지정된다.