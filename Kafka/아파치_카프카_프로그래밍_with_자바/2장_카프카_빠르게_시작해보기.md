# 2장 카프카 빠르게 시작해보기
카프카 브로커의 기본 포트는 9092이고 주키퍼의 기본 포트는 2181이다. EC2에 설치된 브로커에 접속하기 위해서는 보안 그룹의 Inbound 설정에 9092와 2181 포트를 열어야 한다.  
  
## 주키퍼, 카프카 브로커 실행
카프카 바이너리 패키지를 다운로드한다.  
```bash
wget http://archive.apache.org/dist/kafka/2.5.0/kafka+2.12-2.5.0.tgz
tar xvf kafka_2.12-2.5.0.tgz
```
xvf 옵션으로 아카이브에서 파일을 추출하고, 파일의 이름을 지정할 수 있다. v 옵션은 명령이 수행되는 동안 진행 상황을 자세히 보여준다.  
  
카프카 브로커를 실행하기 위해서는 힙 메모리 설정이 필요하다.  
카프카 패키지의 힙 메모리는 카프카 브로커는 1G, 주키퍼는 512MB로 기본 설정되어 있다.

`KAFKA_HEAP_OPTS` 환경변수를 힙 메모리 사이즈와 함께 지정하면 된다.  
터미널 세션이 종료되고 나면 초기화되는 것을 막기 위해 환경변수 선언문을 ~/.bashrc 파일에 넣자.  
```text
~/ 는 사용자의 홈 디렉토리를 나타낸다.
echo ~/ 출력 시 
/home/ec2-user/ 가 나온다.
```
카프카 브로커 실행 시 메모리를 설정하는 부분은 kafka-server-start.sh 스크립트 내부에서 확인할 수 있다.  
```bash
if ["x$KAFKA_HEAP_OPTS" = "x"]; then
    export KAFKA_HEAP_OPTS="-Xmx1G -Xms1G"
fi
```
일반적으로 카프카 브로커를 실행할 때 `-daemon` 옵션을 붙여 백그라운드로 실행하는 것이 일반적인 운영방법이다.  
  
그 다음으로 카프카 브로커 실행 옵션을 설정해야 한다.(config/server.properties)  
`advertised.listener`를 설정해주면 되는데, 카프카 클라이언트 또는 커맨드 라인 툴을 브로커와 연결할 때 사용한다.  
이미 실행되고 있는 카프카 브로커의 설정을 변경하고 싶다면 브로커를 재시작해야 하므로 신중히 설정하는 것을 추천한다.  
  
카프카 바이너리가 포함된 폴더에는 브로커와 같이 실행할 주키퍼가 준비되어 있다. 분산 코디네이션 서비스를 제공하는 주키퍼는 `카프카의 클러스터 설정 리더 정보, 컨트롤러 정보`를 담고 있어 카프카를 실행하는 데에 필요한 필수 애플리케이션이다. 주키퍼를 상용환경에서 안전하게 운영하기 위해서는 3대 이상의 서버로 구성하여 사용한다. 주키퍼가 정상적으로 실행되었는지 jps 명령어로 확인할 수 있다. jps는 JVM 프로세스 상태를 보는 도구로서 JVM 위에서 동작하는 주키퍼의 프로세스를 확인할 수 있다.  
`bin/zookeeper-server-start.sh -daemon config/zookeeper.properties`
  
이제 카프카 브로커를 -daemon옵션과 함께 백그라운드 모드로 실행하자.  
tail 명령어로 로그를 확인하여 카프카 브로커가 정상 동작하는지 확인할 수 있다. 카프카 브로커의 로그를 확인하는 것은 매우 중요한데, 카프카 클라이언트를 개발할 떄 뿐만 아니라 카프카 클러스터를 운영할 때 이슈가 발생할 경우 모두 카프카 브로커에 로그가 남기 때문이다.  
  
`tail -f logs/server.log`
  
카프카 브로커에 대한 정보를 가져올 수 있는 명령어를 사용해 카프카 브로커와 정상적으로 연동되는지 확인할 수 있다.  
`bin/kafka-broker-api-versions.sh --bootstrap-server 13.125.222.89:9092`
## 카프카 커맨드 라인 툴