# 스레드 성능
Latency: **지연 시간은 시간 단위로 측정되고 작업 하나의 완료 시간으로 정의된다.**    
Throughput: **일정 시간 동안 완료한 작업의 양으로 시간 단위당 작업으로 측정된다.**    
  
## Latency
멀티스레드 프로그래밍에서 지연 시간을 어떻게 줄일까?  
싱글 스레드로 T의 지연 시간이 걸리는 작업이 있다. 작업을 N개의 하위 작업으로 나눈 후 각각 다른 스레드에 할당하면 지연 시간을 T/N으로 줄일 수 있다.(N = 하위 작업의 개수)  
  
이런 이론적인 목표를 달성하려면 몇 가지 질문에 답이 필요하다.  
- N이 뭘까? 하위 작업을 원하는 개수로 나눌 수 있다면 몇 개가 될까?  
- 원래 작업을 분할하고 하위 작업을 스케줄링해 나중에 합치는 것에는 대가가 없을까?  
- 어떤 작업이든 원하는 만큼 하위 작업으로 나눌 수 있을까?  
  
일반적으로 N은 컴퓨터의 코어 개수와 최대한 비슷해야 한다. 그 이유는 하위 작업을 모두 병렬로 실행하면 지연 시간이 줄어들기 때문이다. 하위 작업은 다른 코어에서 실행하는 경우에만 완전히 병렬로 실행할 수 있다.  
하나의 스레드만 추가해도 생산성이 떨어져 성능도 저하되고 지연 시간은 늘어나게 된다. 추가된 스레드는 다른 스레드를 코어에서 앞뒤로 밀어내서 컨텍스트 스위치, 캐시 성능 저하, 추가 메모리 소비가 증가한다.  
  
정리하자면,  
스레드 개수와 코어 개수가 같다는 공식은 모든 스레드가 인터럽트 없이 하위 작업을 실행해야 최적이다. 다시 말해, 모든 스레드가 Runnable 상태여야 한다.  
시스템에서 CPU를 많이 소모하는 것은 실행되고 있지 않아야 한다.  
요즘 컴퓨터들은 코어 하나가 스레드 두 개를 동시에 실행할 수 있는 하이퍼스레딩을 사용한다. 물리적인 코어의 하드웨어 유닛 일부를 복제하여 두 스레드가 병행으로 실행되고 하드웨어 유닛 일부가 공유된다. 따라서 모든 스레드를 100% 병렬로 실행할 수는 없다.  
  
하나의 작업을 여러 작업으로 나누고 결과를 종합하는 데 드는 비용에 대해 살펴보자.  
1. 하나의 작업을 여러 작업으로 나누는 비용  
2. 스레드 생성 비용, 스레드에 작업을 전달하고 시작하는 비용  
3. 운영체제가 스레드를 실제로 스케줄링해 스레드가 실행되기까지의 시간  
4. 마지막 스레드가 완료되고 집계를 마쳤다는 신호를 기다리는 시간  
5. 통합 스레드가 신호를 받아 재실행될 때 까지 걸리는 시간  
6. 하위 작업을 하나의 아티팩트로 통합하는 비용  
  
기존 작업이 길고 무거울수록 작업을 분할해 병렬로 실행할 가치가 있다. 작고 사소한 작업이라면 굳이 분할하고 병렬로 실행할 가치가 없다.  
  
모든 작업을 여러 개별 작업으로 나누고 병렬로 실행할 수 있는 것은 아니다.    